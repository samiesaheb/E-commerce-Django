<header class="bg-white shadow-md sticky top-0 z-50" x-data="{ open: false }">
  <div class="max-w-7xl mx-auto px-4 py-1">
    <div class="flex items-center justify-between">

      <!-- Left: Hamburger Menu -->
      <div class="flex-1">
        <button @click="open = !open" class="text-gray-700 hover:text-red-600 focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
               viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>

        <!-- Dropdown Menu -->
        <div x-show="open" @click.outside="open = false"
             class="absolute mt-2 bg-white shadow-lg border rounded-md z-50 w-48 p-2 space-y-1">
          <a href="/about/" class="block px-3 py-2 text-sm hover:bg-gray-100 rounded">About</a>
          <div class="relative group">
            <a href="/brands/" class="block px-3 py-2 text-sm hover:bg-gray-100 rounded">Brands</a>
            <div class="ml-4 mt-1 pl-2 border-l border-gray-200 hidden group-hover:block">
              <a href="/brands/geometry/" class="block px-3 py-1 text-sm hover:bg-gray-100">Geometry</a>
              <a href="/brands/facial-care/" class="block px-3 py-1 text-sm hover:bg-gray-100">Facial Care</a>
              <a href="/brands/body-and-skin-care/" class="block px-3 py-1 text-sm hover:bg-gray-100">Body & Skin Care</a>
              <a href="/brands/hair-care/" class="block px-3 py-1 text-sm hover:bg-gray-100">Hair Care</a>
            </div>
          </div>
          <a href="/contact/" class="block px-3 py-2 text-sm hover:bg-gray-100 rounded">Contact</a>
        </div>
      </div>

      <!-- Center: Logo + Search -->
      <div class="flex flex-col items-center">
        <a href="/" class="text-xl font-extrabold text-red-600">Sky High</a>

        <!-- Alpine.js powered live search -->
        <div
          x-data="{ query: '', results: [], show: false, fetchResults() {
            if (this.query.length > 1) {
              fetch(`/products/autocomplete/?q=${this.query}`)
                .then(res => res.json())
                .then(data => {
                  this.results = data;
                  this.show = true;
                });
            } else {
              this.results = [];
              this.show = false;
            }
          }}"
          class="relative w-80 mt-1"
        >
          <form action="{% url 'products:search' %}" method="GET" class="w-full">
            <div class="flex items-center rounded-full border border-gray-300 bg-gray-50 shadow-sm focus-within:ring-2 focus-within:ring-red-500 transition">
              <input
                type="text"
                name="q"
                placeholder="Search products..."
                x-model="query"
                x-on:input.debounce.300ms="fetchResults"
                class="flex-grow pl-4 py-2 bg-transparent text-sm placeholder-gray-400 focus:outline-none"
                autocomplete="off"
              />
              <button type="submit" class="px-3 text-gray-500 hover:text-red-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z"/>
                </svg>
              </button>
            </div>
          </form>

          <!-- Search dropdown -->
          <ul
            x-show="show"
            x-transition
            @click.outside="show = false"
            class="absolute w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-50"
          >
            <template x-for="item in results" :key="item.id">
              <li class="px-4 py-2 hover:bg-gray-100 text-sm">
                <a :href="`/products/${item.slug}/`" x-text="item.name" class="block text-gray-700"></a>
              </li>
            </template>
          </ul>
        </div>
      </div>

      <!-- Right: Cart + Auth -->
      <div
        class="flex-1 flex justify-end space-x-4 text-sm font-medium text-gray-700 items-center"
        x-data="{ count: {{ cart_item_count|default:0 }} }"
        x-init="window.addEventListener('cart-updated', e => count = e.detail.count)"
        id="cart-icon"
      >
        <!-- Cart icon with dynamic badge -->
        <a href="{% url 'cart:show' %}" class="relative hover:text-red-600 transition-colors duration-200" aria-label="View Cart">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 hover:text-red-600" fill="none"
               viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
                  d="M16 11V7a4 4 0 10-8 0v4M5 11h14l-1.5 9h-11L5 11z"/>
          </svg>
          <template x-if="count > 0">
            <span class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-semibold rounded-full h-5 w-5 flex items-center justify-center shadow">
              <span x-text="count"></span>
            </span>
          </template>
        </a>

        <!-- Auth Links -->
        {% if user.is_authenticated %}
          <form method="POST" action="{% url 'account_logout' %}">
            {% csrf_token %}
            <button type="submit" class="hover:text-red-600 bg-transparent border-none p-0 m-0">Logout</button>
          </form>
          <a href="{% url 'auth:profile' %}" class="hover:text-red-600">My Profile</a>
        {% else %}
          <a href="{% url 'auth:login' %}" class="hover:text-red-600">Login</a>
          <a href="{% url 'auth:signup' %}" class="hover:text-red-600">Sign up</a>
        {% endif %}
      </div>

    </div>
  </div>
</header>
