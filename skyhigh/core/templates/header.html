{% load static %}

<!-- Scroll Progress Bar -->
<div x-data="{ scroll: 0 }"
     x-init="window.addEventListener('scroll', () => { scroll = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100; })"
     class="fixed top-0 left-0 w-full h-1 bg-red-600 z-50">
  <div :style="{ width: scroll + '%' }" class="h-1 bg-red-500 transition-all"></div>
</div>

<div x-data="{ open: false, showAuthSidebar: false, lastScroll: 0, hidden: false, showBrands: false, showSearch: false, count: {{ cart_item_count|default:0 }}, activeDropdown: null }"
     x-init="
  window.addEventListener('scroll', () => {
    const current = window.pageYOffset;
    hidden = current > lastScroll && current > 100;
    lastScroll = current;
  });
  window.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      open = false;
      showAuthSidebar = false;
      showSearch = false;
    }
  });
  window.addEventListener('cart-updated', e => count = e.detail.count);
">

  <!-- HEADER -->
  <header
    @keydown.escape.window="open = false; showAuthSidebar = false; showSearch = false"
    :class="{ 'translate-y-[-100%]': hidden, 'bg-white/70 backdrop-blur border-b border-gray-200': window.pageYOffset > 10 }"
    class="bg-white border-b border-gray-200 sticky top-0 z-50 transition-transform duration-300">

    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-4 relative">
      <div class="flex items-center justify-between relative">

        <!-- Sidebar Toggle -->
        <div class="relative z-50">
          <button @mouseenter="open = true" class="text-gray-700 hover:text-red-600 focus:outline-none" aria-label="Toggle Sidebar">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
        </div>

        <!-- Logo -->
        <a href="/" class="absolute left-1/2 transform -translate-x-1/2 flex items-center space-x-2">
          <img src="{% static 'images/logo.jpg' %}" alt="Sky High Logo" class="h-10 w-auto sm:h-12" />
          <span class="text-2xl sm:text-3xl font-extrabold text-red-600 whitespace-nowrap sky-font">SKY HIGH</span>
        </a>

        <!-- Right Icons -->
        <div class="flex items-center gap-6 sm:gap-8 text-sm font-medium text-gray-700 relative z-50">

          <!-- Search Icon -->
          <div class="relative"
               @mouseenter="showSearch = true; activeDropdown = null"
               @mouseleave="showSearch = false">
            <button class="hover:text-red-600 focus:outline-none" aria-label="Search Products">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z"/>
              </svg>
            </button>
          </div>

          <!-- Cart and Profile Icons would follow here... -->

        </div>
      </div>
    </div>
  </header>

  <!-- FLOATING SEARCH BAR CENTERED -->
  <div class="fixed top-[4.5rem] left-1/2 transform -translate-x-1/2 w-full max-w-2xl z-40"
       x-show="showSearch"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0 -translate-y-2"
       x-transition:enter-end="opacity-100 translate-y-0"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100 translate-y-0"
       x-transition:leave-end="opacity-0 -translate-y-2"
       x-cloak
       @mouseenter="showSearch = true"
       @mouseleave="showSearch = false">
    {% include "core/search_input.html" %}
  </div>

</div>
